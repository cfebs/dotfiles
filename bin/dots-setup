#!/usr/bin/env bash

################################################################################
# Idempotent $HOME/dots setup scripts
################################################################################

_stderr() { echo "$@" 1>&2; }
_log() { _stderr ">> $@"; }

# temp dirs for vim etc
mkdir -p ~/.vim-tmp ~/.tmp ~/tmp

# link vmrc to nvim
mkdir -p .config/nvim
ln -sf $HOME/.vimrc $HOME/.config/nvim/init.vim

# vim plug
DEST_FILE=
if which neovim 1>/dev/null 2>&1; then
    _log "using nvim"
	DEST_FILE="${XDG_DATA_HOME:-$HOME/.local/share}/nvim/site/autoload/plug.vim"
elif which vim 1>/dev/null 2>&1; then
    _log "using vim"
	DEST_FILE="$HOME/.vim/autoload/plug.vim"
fi

if [[ ! -z "$DEST_FILE" ]] && [[ ! -e "$DEST_FILE" ]]; then
    _log "fetching vim plugged"
    curl -fLo $DEST_FILE --create-dirs \
           https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi
